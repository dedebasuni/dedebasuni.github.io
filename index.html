<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .cursor-pointer { cursor: pointer; }
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 10px;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        header {
            background: linear-gradient(45deg, #007bff, #6610f2);
            color: white;
        }
        .lazy-load {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .lazy-load.loaded {
            opacity: 1;
        }
    </style>
</head>
<body>
    <header class="py-4 text-center shadow-lg">
        <h2 class="font-weight-bold">My Notes</h2>
        <div class="input-group w-75 mx-auto my-3">
            <select id="categoryFilter" class="form-select w-25">
                <option value="">Semua Kategori</option>
            </select>
            <button class="btn btn-primary ms-2" onclick="randomPost()">ðŸŽ² Post Acak</button>
        </div>
    </header>

    <main class="container py-4">
        <div class="row g-4" id="posts"></div>
    </main>

    <footer class="bg-light text-center py-3">
        <p>&copy; 2025 My Notes | ðŸ”” <span id="newPostAlert"></span></p>
    </footer>

    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycby9EhjLZtCAv8e65-K-5vl5B2Rz5ny82bzuts_TZnbFUVq0eD2jbJ6gB2QR2CP-KU7rXg/exec";
        let posts = [];

        async function fetchPosts() {
            try {
                const res = await fetch(apiUrl);
                posts = await res.json();
                posts = posts.filter(post => post.Status === "Published"); // Hanya tampilkan yang dipublikasikan
                posts.sort((a, b) => new Date(b.Tanggal) - new Date(a.Tanggal)); // Sortir berdasarkan tanggal terbaru
                populateCategoryFilter();
                renderPosts(posts);
            } catch (error) {
                document.getElementById("posts").innerHTML = "<p class='text-danger'>Gagal memuat data.</p>";
                console.error("Error fetching data:", error);
            }
        }

        fetchPosts();

        function populateCategoryFilter() {
            let categories = [...new Set(posts.map(post => post.Kategori))];
            const categorySelect = document.getElementById("categoryFilter");
            categories.forEach(category => {
                let option = document.createElement("option");
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            categorySelect.addEventListener("change", function() {
                let selectedCategory = this.value;
                let filteredPosts = selectedCategory ? posts.filter(post => post.Kategori === selectedCategory) : posts;
                renderPosts(filteredPosts);
            });
        }

        function renderPosts(postList) {
            let htmlContent = '';
            postList.forEach(post => {
                htmlContent += `
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="card p-3 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-primary cursor-pointer" onclick="openModal('${post.Judul}')">${post.Judul}</h5>
                                <p class="text-muted">${post.Kategori} | ${post.Tags ? post.Tags : 'Tanpa tag'}</p>
                                <img class="lazy-load img-fluid" data-src="${post.Gambar}" alt="${post.Judul}">
                            </div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('posts').innerHTML = htmlContent;
            lazyLoadImages();
        }

        function lazyLoadImages() {
            const images = document.querySelectorAll(".lazy-load");
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.getAttribute("data-src");
                        img.classList.add("loaded");
                        observer.unobserve(img);
                    }
                });
            }, { threshold: 0.1 });

            images.forEach(img => observer.observe(img));
        }

        function openModal(title) {
            const post = posts.find(p => p.Judul === title);
            alert(`Menampilkan artikel: ${post.Judul}`);
        }

        function randomPost() {
            if (posts.length === 0) {
                alert("Belum ada postingan tersedia. Coba muat ulang halaman.");
                return;
            }
            const randomIndex = Math.floor(Math.random() * posts.length);
            openModal(posts[randomIndex].Judul);
        }
    </script>
</body>
</html>
