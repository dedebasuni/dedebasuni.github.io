<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .cursor-pointer { cursor: pointer; }
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 10px;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        header {
            background: linear-gradient(45deg, #007bff, #6610f2);
            color: white;
        }
        .btn-primary {
            background-color: #007bff;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <header class="py-4 text-center shadow-lg">
        <h2 class="font-weight-bold">My Notes</h2>
        <div class="input-group w-75 mx-auto my-3">
            <input type="text" id="search" class="form-control w-50 mx-auto" placeholder="Cari artikel atau tag...">
            <button class="btn btn-primary ms-2" onclick="randomPost()">üé≤ Post Acak</button>
        </div>
    </header>

    <main class="container py-4">
        <div class="row g-4" id="posts"></div>
    </main>

    <footer class="bg-light text-center py-3">
        <p>&copy; 2025 My Notes | üîî <span id="newPostAlert"></span></p>
    </footer>

    <div id="postModal" class="modal fade" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="modalTitle" class="modal-title font-weight-bold"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modalContent"></p>
                    <img id="modalImage" class="img-fluid d-none" alt="Post Image">
                </div>
                <div class="modal-footer">
                    <button id="likeButton" class="btn btn-outline-danger">
                        <i class="fas fa-heart"></i> Like
                    </button>
                    <span id="likeCount" class="ms-2">0 Likes</span>
                    <span id="viewCount" class="ms-2">üëÅÔ∏è 0 views</span>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiUrl = "https://script.google.com/macros/s/AKfycby9EhjLZtCAv8e65-K-5vl5B2Rz5ny82bzuts_TZnbFUVq0eD2jbJ6gB2QR2CP-KU7rXg/exec";
        let posts = [];

        async function fetchPosts() {
            try {
                const res = await fetch(apiUrl);
                posts = await res.json();
                renderPosts(posts);
            } catch (error) {
                document.getElementById("posts").innerHTML = "<p class='text-danger'>Gagal memuat data.</p>";
                console.error("Error fetching data:", error);
            }
        }

        fetchPosts();

        function renderPosts(postList) {
            let htmlContent = '';
            postList.forEach((post, index) => {
                htmlContent += `
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="card p-3 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-primary cursor-pointer" onclick="openModal(${index})">${post.Judul}</h5>
                                <p class="text-muted">${post.Tags ? post.Tags : 'Tanpa tag'}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('posts').innerHTML = htmlContent;
        }

        document.getElementById('search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredPosts = posts.filter(post => {
                return post.Judul?.toLowerCase().includes(searchTerm) || (post.Tags && post.Tags.toLowerCase().includes(searchTerm));
            });
            renderPosts(filteredPosts);
        });

        function openModal(index) {
            const post = posts[index];
            document.getElementById('modalTitle').innerText = post.Judul;
            document.getElementById('modalContent').innerText = post.Isi;
            const modalImage = document.getElementById('modalImage');

            if (post.Gambar) {
                modalImage.src = post.Gambar;
                modalImage.classList.remove('d-none');
            } else {
                modalImage.classList.add('d-none');
            }

            let views = localStorage.getItem(`views_${post.Judul}`) || 0;
            views++;
            localStorage.setItem(`views_${post.Judul}`, views);
            document.getElementById('viewCount').innerText = `üëÅÔ∏è ${views} views`;

            let likeCount = localStorage.getItem(`likeCount_${post.Judul}`) || 0;
            document.getElementById('likeCount').innerText = `${likeCount} Likes`;

            document.getElementById('likeButton').addEventListener('click', function() {
                likeCount++;
                localStorage.setItem(`likeCount_${post.Judul}`, likeCount);
                document.getElementById('likeCount').innerText = `${likeCount} Likes`;
            });

            let modalElement = new bootstrap.Modal(document.getElementById('postModal'));
            modalElement.show();
        }

        function randomPost() {
            if (posts.length === 0) {
                alert("Belum ada postingan tersedia. Coba muat ulang halaman.");
                return;
            }
            const randomIndex = Math.floor(Math.random() * posts.length);
            openModal(randomIndex);
        }
    </script>
</body>
</html>
