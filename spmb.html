<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPMB SMAS PGRI Takokak</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    :root {
      --primary: #2563eb;
      --secondary: #1e40af;
      --light: #f8fafc;
      --dark: #1e293b;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f1f5f9;
    }
    
    .navbar-brand img {
      height: 40px;
    }
    
    .hero-section {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 4rem 0;
      border-radius: 0 0 20px 20px;
    }
    
    .card {
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
      margin-bottom: 20px;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    
    .btn-primary:hover {
      background-color: var(--secondary);
      border-color: var(--secondary);
    }
    
    .form-section {
      background-color: white;
      border-radius: 10px;
      padding: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .footer {
      background-color: var(--dark);
      color: white;
      padding: 2rem 0;
    }
    
    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    
    .step {
      text-align: center;
      flex: 1;
      position: relative;
    }
    
    .step-number {
      width: 40px;
      height: 40px;
      background-color: #e2e8f0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      font-weight: bold;
      color: #64748b;
    }
    
    .step.active .step-number {
      background-color: var(--primary);
      color: white;
    }
    
    .step.completed .step-number {
      background-color: #10b981;
      color: white;
    }
    
    .step-title {
      font-size: 0.9rem;
      color: #64748b;
    }
    
    .step.active .step-title {
      color: var(--primary);
      font-weight: bold;
    }
    
    .step.completed .step-title {
      color: #10b981;
    }
    
    .step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 20px;
      left: 50%;
      width: 100%;
      height: 2px;
      background-color: #e2e8f0;
      z-index: -1;
    }
    
    .document-preview {
      border: 2px dashed #cbd5e1;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
      position: relative;
    }
    
    .document-preview img {
      max-width: 100%;
      max-height: 200px;
      margin-bottom: 1rem;
    }
    
    .document-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      background-color: #f8fafc;
      border-radius: 5px;
      margin-bottom: 0.5rem;
    }
    
    .document-item i {
      margin-right: 10px;
      color: var(--primary);
    }
    
    .status-badge {
      padding: 0.35rem 0.65rem;
      border-radius: 50px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .status-pending {
      background-color: #fef3c7;
      color: #92400e;
    }
    
    .status-verified {
      background-color: #d1fae5;
      color: #065f46;
    }
    
    .status-rejected {
      background-color: #fee2e2;
      color: #991b1b;
    }
    
    .admin-sidebar {
      min-height: calc(100vh - 56px);
      background-color: var(--dark);
      color: white;
      padding: 1rem 0;
    }
    
    .admin-sidebar .nav-link {
      color: rgba(255, 255, 255, 0.8);
      border-radius: 5px;
      margin-bottom: 0.25rem;
      padding: 0.5rem 1rem;
    }
    
    .admin-sidebar .nav-link:hover {
      color: white;
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .admin-sidebar .nav-link.active {
      color: white;
      background-color: var(--primary);
    }
    
    .admin-sidebar .nav-link i {
      margin-right: 10px;
    }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    @media (max-width: 768px) {
      .hero-section {
        padding: 2rem 0;
      }
      
      .step-title {
        font-size: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="https://via.placeholder.com/40" alt="Logo Sekolah" class="me-2">
        <span>SPMB SMAS PGRI Takokak</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#home">Beranda</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#registration">Pendaftaran</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#schedule">Jadwal</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#fees">Biaya</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#status">Cek Status</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#adminLoginModal">
              <i class="bi bi-lock-fill"></i> Admin
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section id="home" class="hero-section">
    <div class="container text-center">
      <h1 class="display-4 fw-bold mb-3">Penerimaan Peserta Didik Baru</h1>
      <p class="lead mb-4">Tahun Ajaran 2024/2025</p>
      <a href="#registration" class="btn btn-light btn-lg px-4 me-2">Daftar Sekarang</a>
      <a href="#status" class="btn btn-outline-light btn-lg px-4">Cek Status</a>
    </div>
  </section>

  <!-- Main Content -->
  <div class="container my-5">
    <!-- Registration Section -->
    <section id="registration" class="mb-5">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h3 class="mb-0">Formulir Pendaftaran</h3>
            </div>
            <div class="card-body">
              <div id="registrationFormContainer">
                <!-- Form will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Schedule Section -->
    <section id="schedule" class="mb-5">
      <h2 class="text-center mb-4">Jadwal SPMB</h2>
      <div class="row" id="scheduleContainer">
        <!-- Schedule will be loaded here -->
      </div>
    </section>

    <!-- Fees Section -->
    <section id="fees" class="mb-5">
      <h2 class="text-center mb-4">Biaya Pendaftaran</h2>
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="table-responsive">
            <table class="table table-bordered table-hover" id="feesTable">
              <thead class="table-primary">
                <tr>
                  <th>Jenis Biaya</th>
                  <th>Nominal</th>
                  <th>Keterangan</th>
                  <th>Batas Pembayaran</th>
                </tr>
              </thead>
              <tbody>
                <!-- Fees will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Status Check Section -->
    <section id="status" class="mb-5">
      <div class="row justify-content-center">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h3 class="mb-0">Cek Status Pendaftaran</h3>
            </div>
            <div class="card-body">
              <form id="statusCheckForm">
                <div class="mb-3">
                  <label for="statusNomor" class="form-label">Nomor Pendaftaran</label>
                  <input type="text" class="form-control" id="statusNomor" required>
                </div>
                <div class="mb-3">
                  <label for="statusNISN" class="form-label">NISN</label>
                  <input type="text" class="form-control" id="statusNISN" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Cek Status</button>
              </form>
              <div id="statusResult" class="mt-4">
                <!-- Status result will be shown here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-md-4 mb-4 mb-md-0">
          <h5>Tentang Sekolah</h5>
          <p>SMAS PGRI Takokak adalah sekolah unggulan yang berkomitmen untuk memberikan pendidikan berkualitas dengan fasilitas lengkap dan tenaga pengajar profesional.</p>
        </div>
        <div class="col-md-4 mb-4 mb-md-0">
          <h5>Kontak Kami</h5>
          <ul class="list-unstyled">
            <li><i class="bi bi-geo-alt-fill me-2"></i> Jl. Pahlawan No.5, Takokak</li>
            <li><i class="bi bi-telephone-fill me-2"></i> (0266) 6482212</li>
            <li><i class="bi bi-envelope-fill me-2"></i> info@smapgritakokak.sch.id</li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5>Jam Operasional</h5>
          <ul class="list-unstyled">
            <li>Senin - Jumat: 07.00 - 16.00</li>
            <li>Sabtu: 08.00 - 12.00</li>
            <li>Minggu & Hari Libur: Tutup</li>
          </ul>
        </div>
      </div>
      <hr class="my-4 bg-light">
      <div class="text-center">
        <p class="mb-0">&copy; 2025 SMAS PGRI Takokak. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Admin Login Modal -->
  <div class="modal fade" id="adminLoginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Login Admin</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="adminLoginForm">
            <div class="mb-3">
              <label for="adminUsername" class="form-label">Username</label>
              <input type="text" class="form-control" id="adminUsername" required>
            </div>
            <div class="mb-3">
              <label for="adminPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="adminPassword" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Student Login Modal -->
  <div class="modal fade" id="studentLoginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Login Siswa</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="studentLoginForm">
            <div class="mb-3">
              <label for="studentNomor" class="form-label">Nomor Pendaftaran</label>
              <input type="text" class="form-control" id="studentNomor" required>
            </div>
            <div class="mb-3">
              <label for="studentNISN" class="form-label">NISN</label>
              <input type="text" class="form-control" id="studentNISN" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Document Upload Modal -->
  <div class="modal fade" id="documentUploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Upload Dokumen</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="documentUploadForm">
            <input type="hidden" id="docNomorPendaftaran">
            <input type="hidden" id="docNISN">
            <input type="hidden" id="docFieldName">
            
            <div class="mb-3">
              <label class="form-label">Jenis Dokumen</label>
              <input type="text" class="form-control" id="docTypeDisplay" readonly>
            </div>
            
            <div class="mb-3">
              <label for="documentFile" class="form-label">Pilih File</label>
              <input type="file" class="form-control" id="documentFile" accept=".pdf,.jpg,.jpeg,.png" required>
              <div class="form-text">Format: PDF, JPG, PNG (Maks. 2MB)</div>
            </div>
            
            <div class="document-preview" id="documentPreview">
              <i class="bi bi-file-earmark-text" style="font-size: 3rem; color: #94a3b8;"></i>
              <p class="text-muted">Pratinjau dokumen akan muncul di sini</p>
            </div>
            
            <button type="submit" class="btn btn-primary w-100">Upload Dokumen</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Update Modal (Admin) -->
  <div class="modal fade" id="statusUpdateModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Update Status Pendaftaran</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="statusUpdateForm">
            <input type="hidden" id="updateNomorPendaftaran">
            
            <div class="mb-3">
              <label for="updateStatus" class="form-label">Status</label>
              <select class="form-select" id="updateStatus" required>
                <option value="Belum Diverifikasi">Belum Diverifikasi</option>
                <option value="Diterima">Diterima</option>
                <option value="Ditolak">Ditolak</option>
                <option value="Dalam Proses">Dalam Proses</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="updateNotes" class="form-label">Catatan (Opsional)</label>
              <textarea class="form-control" id="updateNotes" rows="3"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary w-100">Update Status</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-dark bg-opacity-50" id="loadingSpinner" style="z-index: 9999; display: none;">
    <div class="text-center">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-white mt-3" id="loadingText">Memproses...</p>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    // Global variables
    let currentStep = 1;
    let registrationData = {};
    let adminToken = null;
    let currentAdmin = null;
    let studentData = null;
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Load schedule and fees data
      loadScheduleData();
      loadFeesData();
      
      // Load registration form
      loadRegistrationForm();
      
      // Setup form event listeners
      setupFormEventListeners();
      
      // Check if there's a hash in URL
      if (window.location.hash) {
        const target = document.querySelector(window.location.hash);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      }
    });
    
    // Setup form event listeners
    function setupFormEventListeners() {
      // Admin login form
      document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        handleAdminLogin();
      });
      
      // Student login form
      document.getElementById('studentLoginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        handleStudentLogin();
      });
      
      // Status check form
      document.getElementById('statusCheckForm').addEventListener('submit', function(e) {
        e.preventDefault();
        checkRegistrationStatus();
      });
      
      // Document upload form
      document.getElementById('documentUploadForm').addEventListener('submit', function(e) {
        e.preventDefault();
        uploadDocument();
      });
      
      // Document file input change
      document.getElementById('documentFile').addEventListener('change', function(e) {
        previewDocument(e.target.files[0]);
      });
      
      // Status update form (admin)
      document.getElementById('statusUpdateForm').addEventListener('submit', function(e) {
        e.preventDefault();
        updateRegistrationStatus();
      });
    }
    
    // Load registration form steps
    function loadRegistrationForm() {
      const container = document.getElementById('registrationFormContainer');
      
      // Step 1: Personal Information
      const step1 = `
        <div class="step-indicator">
          <div class="step active">
            <div class="step-number">1</div>
            <div class="step-title">Data Pribadi</div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-title">Data Orang Tua</div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-title">Data Sekolah</div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-title">Dokumen</div>
          </div>
          <div class="step">
            <div class="step-number">5</div>
            <div class="step-title">Selesai</div>
          </div>
        </div>
        
        <form id="registrationFormStep1">
          <h5 class="mb-4">Data Pribadi Calon Siswa</h5>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="jenis_pendaftaran" class="form-label">Jenis Pendaftaran</label>
              <select class="form-select" id="jenis_pendaftaran" required>
                <option value="" selected disabled>Pilih Jenis Pendaftaran</option>
                <option value="Siswa baru">Siswa Baru</option>
                <option value="Pindahan">Pindahan</option>
                <option value="Kembali bersekolah">Kembali Bersekolah</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="tahun_ajaran" class="form-label">Tahun Ajaran</label>
              <input type="text" class="form-control" id="tahun_ajaran" value="2024/2025" readonly>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="nisn" class="form-label">NISN</label>
              <input type="text" class="form-control" id="nisn" maxlength="10" required>
              <div class="form-text">10 digit nomor NISN</div>
            </div>
            <div class="col-md-6">
              <label for="nik" class="form-label">NIK</label>
              <input type="text" class="form-control" id="nik" maxlength="16" required>
              <div class="form-text">16 digit nomor NIK</div>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="nama" class="form-label">Nama Lengkap</label>
              <input type="text" class="form-control" id="nama" required>
            </div>
            <div class="col-md-6">
              <label for="jenis_kelamin" class="form-label">Jenis Kelamin</label>
              <select class="form-select" id="jenis_kelamin" required>
                <option value="" selected disabled>Pilih Jenis Kelamin</option>
                <option value="Laki-laki">Laki-laki</option>
                <option value="Perempuan">Perempuan</option>
              </select>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="tempat_lahir" class="form-label">Tempat Lahir</label>
              <input type="text" class="form-control" id="tempat_lahir" required>
            </div>
            <div class="col-md-6">
              <label for="tanggal_lahir" class="form-label">Tanggal Lahir</label>
              <input type="date" class="form-control" id="tanggal_lahir" required>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="agama" class="form-label">Agama</label>
              <select class="form-select" id="agama" required>
                <option value="" selected disabled>Pilih Agama</option>
                <option value="Islam">Islam</option>
                <option value="Kristen">Kristen</option>
                <option value="Katholik">Katholik</option>
                <option value="Hindu">Hindu</option>
                <option value="Budha">Budha</option>
                <option value="Khonghucu">Khonghucu</option>
                <option value="Kepercayaan kpd Tuhan YME">Kepercayaan kepada Tuhan YME</option>
                <option value="lainnya">Lainnya</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="whatsapp" class="form-label">Nomor WhatsApp</label>
              <input type="text" class="form-control" id="whatsapp" required>
            </div>
          </div>
          
          <div class="mb-3">
            <label for="alamat" class="form-label">Alamat Lengkap</label>
            <textarea class="form-control" id="alamat" rows="3" required></textarea>
          </div>
          
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email">
            <div class="form-text">Opsional, untuk menerima notifikasi</div>
          </div>
          
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" disabled>Kembali</button>
            <button type="submit" class="btn btn-primary">Selanjutnya</button>
          </div>
        </form>
      `;
      
      container.innerHTML = step1;
      
      // Add event listener for step 1 form
      document.getElementById('registrationFormStep1').addEventListener('submit', function(e) {
        e.preventDefault();
        saveStep1Data();
      });
    }
    
    // Save step 1 data and proceed to step 2
    function saveStep1Data() {
      // Collect data from step 1
      registrationData = {
        jenis_pendaftaran: document.getElementById('jenis_pendaftaran').value,
        tahun_ajaran: document.getElementById('tahun_ajaran').value,
        nisn: document.getElementById('nisn').value,
        nik: document.getElementById('nik').value,
        nama: document.getElementById('nama').value,
        jenis_kelamin: document.getElementById('jenis_kelamin').value,
        tempat_lahir: document.getElementById('tempat_lahir').value,
        tanggal_lahir: document.getElementById('tanggal_lahir').value,
        agama: document.getElementById('agama').value,
        whatsapp: document.getElementById('whatsapp').value,
        alamat: document.getElementById('alamat').value,
        email: document.getElementById('email').value
      };
      
      // Validate data
      if (!validateStep1Data(registrationData)) {
        return;
      }
      
      // Proceed to step 2
      loadStep2Form();
    }
    
    // Validate step 1 data
    function validateStep1Data(data) {
      // Simple validation - in real app you should do more thorough validation
      if (!data.nisn || data.nisn.length !== 10 || !/^\d+$/.test(data.nisn)) {
        showError('NISN harus 10 digit angka');
        return false;
      }
      
      if (!data.nik || data.nik.length !== 16 || !/^\d+$/.test(data.nik)) {
        showError('NIK harus 16 digit angka');
        return false;
      }
      
      if (!data.tanggal_lahir) {
        showError('Tanggal lahir harus diisi');
        return false;
      }
      
      // Check if student is at least 13 years old
      const birthDate = new Date(data.tanggal_lahir);
      const minDate = new Date();
      minDate.setFullYear(minDate.getFullYear() - 13);
      
      if (birthDate > minDate) {
        showError('Siswa harus berusia minimal 13 tahun');
        return false;
      }
      
      return true;
    }
    
    // Load step 2 form (Parent Data)
    function loadStep2Form() {
      const container = document.getElementById('registrationFormContainer');
      
      const step2 = `
        <div class="step-indicator">
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Pribadi</div>
          </div>
          <div class="step active">
            <div class="step-number">2</div>
            <div class="step-title">Data Orang Tua</div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-title">Data Sekolah</div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-title">Dokumen</div>
          </div>
          <div class="step">
            <div class="step-number">5</div>
            <div class="step-title">Selesai</div>
          </div>
        </div>
        
        <form id="registrationFormStep2">
          <h5 class="mb-4">Data Orang Tua/Wali</h5>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="nama_ayah" class="form-label">Nama Ayah</label>
              <input type="text" class="form-control" id="nama_ayah" required>
            </div>
            <div class="col-md-6">
              <label for="pekerjaan_ayah" class="form-label">Pekerjaan Ayah</label>
              <input type="text" class="form-control" id="pekerjaan_ayah" required>
            </div>
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="nama_ibu" class="form-label">Nama Ibu</label>
              <input type="text" class="form-control" id="nama_ibu" required>
            </div>
            <div class="col-md-6">
              <label for="pekerjaan_ibu" class="form-label">Pekerjaan Ibu</label>
              <input type="text" class="form-control" id="pekerjaan_ibu" required>
            </div>
          </div>
          
          <div class="mb-3">
            <label for="whatsapp_ortu" class="form-label">Nomor WhatsApp Orang Tua/Wali</label>
            <input type="text" class="form-control" id="whatsapp_ortu" required>
            <div class="form-text">Digunakan untuk komunikasi penting</div>
          </div>
          
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" onclick="loadStep1Form()">Kembali</button>
            <button type="submit" class="btn btn-primary">Selanjutnya</button>
          </div>
        </form>
      `;
      
      container.innerHTML = step2;
      
      // Add event listener for step 2 form
      document.getElementById('registrationFormStep2').addEventListener('submit', function(e) {
        e.preventDefault();
        saveStep2Data();
      });
    }
    
    // Save step 2 data and proceed to step 3
    function saveStep2Data() {
      // Collect data from step 2
      registrationData.nama_ayah = document.getElementById('nama_ayah').value;
      registrationData.pekerjaan_ayah = document.getElementById('pekerjaan_ayah').value;
      registrationData.nama_ibu = document.getElementById('nama_ibu').value;
      registrationData.pekerjaan_ibu = document.getElementById('pekerjaan_ibu').value;
      registrationData.whatsapp_ortu = document.getElementById('whatsapp_ortu').value;
      
      // Validate data
      if (!validateStep2Data(registrationData)) {
        return;
      }
      
      // Proceed to step 3
      loadStep3Form();
    }
    
    // Validate step 2 data
    function validateStep2Data(data) {
      if (!data.nama_ayah || !data.nama_ibu) {
        showError('Nama orang tua harus diisi');
        return false;
      }
      
      if (!data.whatsapp_ortu) {
        showError('Nomor WhatsApp orang tua harus diisi');
        return false;
      }
      
      return true;
    }
    
    // Load step 3 form (School Data)
    function loadStep3Form() {
      const container = document.getElementById('registrationFormContainer');
      
      const step3 = `
        <div class="step-indicator">
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Pribadi</div>
          </div>
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Orang Tua</div>
          </div>
          <div class="step active">
            <div class="step-number">3</div>
            <div class="step-title">Data Sekolah</div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-title">Dokumen</div>
          </div>
          <div class="step">
            <div class="step-number">5</div>
            <div class="step-title">Selesai</div>
          </div>
        </div>
        
        <form id="registrationFormStep3">
          <h5 class="mb-4">Data Sekolah Asal</h5>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="asal_sekolah" class="form-label">Nama Sekolah Asal</label>
              <input type="text" class="form-control" id="asal_sekolah" required>
            </div>
            <div class="col-md-6">
              <label for="tahun_lulus" class="form-label">Tahun Lulus/Keluar</label>
              <input type="number" class="form-control" id="tahun_lulus" min="2000" max="2024" required>
            </div>
          </div>
          
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" onclick="loadStep2Form()">Kembali</button>
            <button type="submit" class="btn btn-primary">Selanjutnya</button>
          </div>
        </form>
      `;
      
      container.innerHTML = step3;
      
      // Add event listener for step 3 form
      document.getElementById('registrationFormStep3').addEventListener('submit', function(e) {
        e.preventDefault();
        saveStep3Data();
      });
    }
    
    // Save step 3 data and proceed to step 4
    function saveStep3Data() {
      // Collect data from step 3
      registrationData.asal_sekolah = document.getElementById('asal_sekolah').value;
      registrationData.tahun_lulus = document.getElementById('tahun_lulus').value;
      
      // Validate data
      if (!validateStep3Data(registrationData)) {
        return;
      }
      
      // Proceed to step 4
      loadStep4Form();
    }
    
    // Validate step 3 data
    function validateStep3Data(data) {
      if (!data.asal_sekolah) {
        showError('Nama sekolah asal harus diisi');
        return false;
      }
      
      if (!data.tahun_lulus || data.tahun_lulus < 2000 || data.tahun_lulus > new Date().getFullYear()) {
        showError('Tahun lulus tidak valid');
        return false;
      }
      
      return true;
    }
    
    // Load step 4 form (Documents)
    function loadStep4Form() {
      const container = document.getElementById('registrationFormContainer');
      
      const step4 = `
        <div class="step-indicator">
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Pribadi</div>
          </div>
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Orang Tua</div>
          </div>
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Sekolah</div>
          </div>
          <div class="step active">
            <div class="step-number">4</div>
            <div class="step-title">Dokumen</div>
          </div>
          <div class="step">
            <div class="step-number">5</div>
            <div class="step-title">Selesai</div>
          </div>
        </div>
        
        <form id="registrationFormStep4">
          <h5 class="mb-4">Upload Dokumen Pendukung</h5>
          
          <div class="alert alert-info">
            <i class="bi bi-info-circle-fill me-2"></i> 
            Silakan upload dokumen-dokumen berikut dalam format PDF, JPG, atau PNG (maks. 2MB per file).
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h6 class="card-title">Akta Kelahiran</h6>
                  <p class="card-text text-muted small">Upload scan akta kelahiran</p>
                  <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="openDocumentUploadModal('akta_kelahiran', 'Akta Kelahiran')">
                    <i class="bi bi-upload me-2"></i> Upload
                  </button>
                  <div id="akta_kelahiran_preview" class="mt-2"></div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h6 class="card-title">Kartu Keluarga</h6>
                  <p class="card-text text-muted small">Upload scan kartu keluarga</p>
                  <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="openDocumentUploadModal('kartu_keluarga', 'Kartu Keluarga')">
                    <i class="bi bi-upload me-2"></i> Upload
                  </button>
                  <div id="kartu_keluarga_preview" class="mt-2"></div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h6 class="card-title">Ijazah/SKHUN</h6>
                  <p class="card-text text-muted small">Upload scan ijazah atau SKHUN</p>
                  <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="openDocumentUploadModal('ijazah', 'Ijazah/SKHUN')">
                    <i class="bi bi-upload me-2"></i> Upload
                  </button>
                  <div id="ijazah_preview" class="mt-2"></div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h6 class="card-title">Foto 3x4</h6>
                  <p class="card-text text-muted small">Upload foto ukuran 3x4 latar belakang merah</p>
                  <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="openDocumentUploadModal('foto', 'Foto 3x4')">
                    <i class="bi bi-upload me-2"></i> Upload
                  </button>
                  <div id="foto_preview" class="mt-2"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" onclick="loadStep3Form()">Kembali</button>
            <button type="submit" class="btn btn-primary">Selanjutnya</button>
          </div>
        </form>
      `;
      
      container.innerHTML = step4;
      
      // Add event listener for step 4 form
      document.getElementById('registrationFormStep4').addEventListener('submit', function(e) {
        e.preventDefault();
        saveStep4Data();
      });
    }
    
    // Save step 4 data and proceed to step 5
    function saveStep4Data() {
      // In a real app, you might want to verify that required documents are uploaded
      // For now, we'll just proceed to the final step
      loadStep5Form();
    }
    
    // Load step 5 form (Review and Submit)
    function loadStep5Form() {
      const container = document.getElementById('registrationFormContainer');
      
      const step5 = `
        <div class="step-indicator">
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Pribadi</div>
          </div>
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Orang Tua</div>
          </div>
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Data Sekolah</div>
          </div>
          <div class="step completed">
            <div class="step-number"><i class="bi bi-check"></i></div>
            <div class="step-title">Dokumen</div>
          </div>
          <div class="step active">
            <div class="step-number">5</div>
            <div class="step-title">Selesai</div>
          </div>
        </div>
        
        <div id="registrationFormStep5">
          <div class="text-center mb-5">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
            <h3 class="mt-3">Review Data Pendaftaran</h3>
            <p class="text-muted">Silakan periksa kembali data yang telah Anda isi</p>
          </div>
          
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">Data Pribadi</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <p><strong>Nama Lengkap:</strong> ${registrationData.nama}</p>
                  <p><strong>Jenis Kelamin:</strong> ${registrationData.jenis_kelamin}</p>
                  <p><strong>Tempat, Tanggal Lahir:</strong> ${registrationData.tempat_lahir}, ${formatDate(registrationData.tanggal_lahir)}</p>
                  <p><strong>Agama:</strong> ${registrationData.agama}</p>
                </div>
                <div class="col-md-6">
                  <p><strong>NISN:</strong> ${registrationData.nisn}</p>
                  <p><strong>NIK:</strong> ${registrationData.nik}</p>
                  <p><strong>Alamat:</strong> ${registrationData.alamat}</p>
                  <p><strong>WhatsApp:</strong> ${registrationData.whatsapp}</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">Data Orang Tua</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <p><strong>Nama Ayah:</strong> ${registrationData.nama_ayah}</p>
                  <p><strong>Pekerjaan Ayah:</strong> ${registrationData.pekerjaan_ayah}</p>
                </div>
                <div class="col-md-6">
                  <p><strong>Nama Ibu:</strong> ${registrationData.nama_ibu}</p>
                  <p><strong>Pekerjaan Ibu:</strong> ${registrationData.pekerjaan_ibu}</p>
                </div>
              </div>
              <p class="mt-2"><strong>WhatsApp Orang Tua:</strong> ${registrationData.whatsapp_ortu}</p>
            </div>
          </div>
          
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">Data Sekolah</h5>
            </div>
            <div class="card-body">
              <p><strong>Asal Sekolah:</strong> ${registrationData.asal_sekolah}</p>
              <p><strong>Tahun Lulus/Keluar:</strong> ${registrationData.tahun_lulus}</p>
              <p><strong>Jenis Pendaftaran:</strong> ${registrationData.jenis_pendaftaran}</p>
              <p><strong>Tahun Ajaran:</strong> ${registrationData.tahun_ajaran}</p>
            </div>
          </div>
          
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">Dokumen</h5>
            </div>
            <div class="card-body">
              <div id="documentsReviewList">
                <div class="alert alert-info mb-0">
                  <i class="bi bi-info-circle-fill me-2"></i> 
                  Dokumen akan diupload setelah pendaftaran disubmit
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-check mb-4">
            <input class="form-check-input" type="checkbox" id="agreeTerms" required>
            <label class="form-check-label" for="agreeTerms">
              Saya menyatakan bahwa data yang saya berikan adalah benar dan dapat dipertanggungjawabkan.
            </label>
          </div>
          
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" onclick="loadStep4Form()">Kembali</button>
            <button type="button" class="btn btn-primary" onclick="submitRegistration()">Submit Pendaftaran</button>
          </div>
        </div>
      `;
      
      container.innerHTML = step5;
    }
    
    // Submit registration data to server
    function submitRegistration() {
      // Check if terms are agreed
      if (!document.getElementById('agreeTerms').checked) {
        showError('Anda harus menyetujui pernyataan sebelum melanjutkan');
        return;
      }
      
      showLoading('Mengirim data pendaftaran...');
      
      // Call Google Apps Script function
      google.script.run
        .withSuccessHandler(handleRegistrationSuccess)
        .withFailureHandler(handleRegistrationError)
        .handleFormSubmit(registrationData);
    }
    
    // Handle successful registration
    function handleRegistrationSuccess(response) {
      hideLoading();
      
      if (response.success) {
        // Save registration number for document upload
        registrationData.nomor_pendaftaran = response.nomor_pendaftaran;
        
        // Show success message
        const container = document.getElementById('registrationFormContainer');
        container.innerHTML = `
          <div class="text-center py-5">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
            <h2 class="mt-4">Pendaftaran Berhasil!</h2>
            <p class="lead">Terima kasih telah mendaftar di SMAS PGRI Takokak</p>
            
            <div class="card mx-auto mt-4" style="max-width: 500px;">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Nomor Pendaftaran Anda</h5>
              </div>
              <div class="card-body text-center">
                <h3 class="text-primary">${response.nomor_pendaftaran}</h3>
                <p class="text-muted mb-0">${response.timestamp}</p>
              </div>
            </div>
            
            <div class="alert alert-info mt-4">
              <i class="bi bi-info-circle-fill me-2"></i>
              Silakan catat nomor pendaftaran Anda untuk mengecek status pendaftaran. 
              Informasi lebih lanjut akan dikirim melalui WhatsApp atau email.
            </div>
            
            <div class="mt-4">
              <button class="btn btn-primary me-2" onclick="printRegistration('${response.nomor_pendaftaran}')">
                <i class="bi bi-printer-fill me-2"></i> Cetak Bukti Pendaftaran
              </button>
              <button class="btn btn-outline-primary" onclick="window.location.href='#status'">
                <i class="bi bi-search me-2"></i> Cek Status Pendaftaran
              </button>
            </div>
          </div>
        `;
      } else {
        showError(response.message || 'Terjadi kesalahan saat memproses pendaftaran');
      }
    }
    
    // Handle registration error
    function handleRegistrationError(error) {
      hideLoading();
      showError(error.message || 'Terjadi kesalahan saat memproses pendaftaran');
    }
    
    // Go back to step 1 form
    function loadStep1Form() {
      currentStep = 1;
      loadRegistrationForm();
      
      // Restore values
      if (registrationData) {
        document.getElementById('jenis_pendaftaran').value = registrationData.jenis_pendaftaran || '';
        document.getElementById('tahun_ajaran').value = registrationData.tahun_ajaran || '';
        document.getElementById('nisn').value = registrationData.nisn || '';
        document.getElementById('nik').value = registrationData.nik || '';
        document.getElementById('nama').value = registrationData.nama || '';
        document.getElementById('jenis_kelamin').value = registrationData.jenis_kelamin || '';
        document.getElementById('tempat_lahir').value = registrationData.tempat_lahir || '';
        document.getElementById('tanggal_lahir').value = registrationData.tanggal_lahir || '';
        document.getElementById('agama').value = registrationData.agama || '';
        document.getElementById('whatsapp').value = registrationData.whatsapp || '';
        document.getElementById('alamat').value = registrationData.alamat || '';
        document.getElementById('email').value = registrationData.email || '';
      }
    }
    
    // Go back to step 2 form
    function loadStep2Form() {
      currentStep = 2;
      loadStep2Form();
      
      // Restore values
      if (registrationData) {
        document.getElementById('nama_ayah').value = registrationData.nama_ayah || '';
        document.getElementById('pekerjaan_ayah').value = registrationData.pekerjaan_ayah || '';
        document.getElementById('nama_ibu').value = registrationData.nama_ibu || '';
        document.getElementById('pekerjaan_ibu').value = registrationData.pekerjaan_ibu || '';
        document.getElementById('whatsapp_ortu').value = registrationData.whatsapp_ortu || '';
      }
    }
    
    // Go back to step 3 form
    function loadStep3Form() {
      currentStep = 3;
      loadStep3Form();
      
      // Restore values
      if (registrationData) {
        document.getElementById('asal_sekolah').value = registrationData.asal_sekolah || '';
        document.getElementById('tahun_lulus').value = registrationData.tahun_lulus || '';
      }
    }
    
    // Go back to step 4 form
    function loadStep4Form() {
      currentStep = 4;
      loadStep4Form();
    }
    
    // Open document upload modal
    function openDocumentUploadModal(fieldName, displayName) {
      if (!registrationData.nomor_pendaftaran) {
        showError('Silakan submit pendaftaran terlebih dahulu sebelum upload dokumen');
        return;
      }
      
      document.getElementById('docNomorPendaftaran').value = registrationData.nomor_pendaftaran;
      document.getElementById('docNISN').value = registrationData.nisn;
      document.getElementById('docFieldName').value = fieldName;
      document.getElementById('docTypeDisplay').value = displayName;
      
      // Reset preview
      document.getElementById('documentPreview').innerHTML = `
        <i class="bi bi-file-earmark-text" style="font-size: 3rem; color: #94a3b8;"></i>
        <p class="text-muted">Pratinjau dokumen akan muncul di sini</p>
      `;
      
      // Reset file input
      document.getElementById('documentFile').value = '';
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('documentUploadModal'));
      modal.show();
    }
    
    // Preview document before upload
    function previewDocument(file) {
      const preview = document.getElementById('documentPreview');
      
      if (!file) {
        preview.innerHTML = `
          <i class="bi bi-file-earmark-text" style="font-size: 3rem; color: #94a3b8;"></i>
          <p class="text-muted">Pratinjau dokumen akan muncul di sini</p>
        `;
        return;
      }
      
      // Check file type and size
      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png'];
      const maxSize = 2 * 1024 * 1024; // 2MB
      
      if (!allowedTypes.includes(file.type)) {
        preview.innerHTML = `
          <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Format file tidak didukung. Harap upload file PDF, JPG, atau PNG.
          </div>
        `;
        return;
      }
      
      if (file.size > maxSize) {
        preview.innerHTML = `
          <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Ukuran file terlalu besar. Maksimal 2MB.
          </div>
        `;
        return;
      }
      
      // Show preview for images
      if (file.type.includes('image')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.innerHTML = `
            <img src="${e.target.result}" alt="Preview" class="img-fluid">
            <p class="mt-2 mb-0">${file.name} (${formatFileSize(file.size)})</p>
          `;
        };
        reader.readAsDataURL(file);
      } else {
        // For PDF, just show file info
        preview.innerHTML = `
          <i class="bi bi-file-earmark-pdf" style="font-size: 3rem; color: #ef4444;"></i>
          <p class="mt-2 mb-0">${file.name} (${formatFileSize(file.size)})</p>
        `;
      }
    }
    
    // Upload document to server
    function uploadDocument() {
      const fileInput = document.getElementById('documentFile');
      const file = fileInput.files[0];
      
      if (!file) {
        showError('Silakan pilih file terlebih dahulu');
        return;
      }
      
      // Check file type and size
      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png'];
      const maxSize = 2 * 1024 * 1024; // 2MB
      
      if (!allowedTypes.includes(file.type)) {
        showError('Format file tidak didukung. Harap upload file PDF, JPG, atau PNG.');
        return;
      }
      
      if (file.size > maxSize) {
        showError('Ukuran file terlalu besar. Maksimal 2MB.');
        return;
      }
      
      showLoading('Mengupload dokumen...');
      
      // Prepare form data
      const formData = new FormData();
      formData.append('file', file);
      formData.append('data', JSON.stringify({
        nomor: document.getElementById('docNomorPendaftaran').value,
        nisn: document.getElementById('docNISN').value,
        fieldName: document.getElementById('docFieldName').value
      }));
      
      // Call Google Apps Script function
      google.script.run
        .withSuccessHandler(handleDocumentUploadSuccess)
        .withFailureHandler(handleDocumentUploadError)
        .doPost(formData);
    }
    
    // Handle successful document upload
    function handleDocumentUploadSuccess(response) {
      hideLoading();
      
      if (response.success) {
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('documentUploadModal'));
        modal.hide();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Dokumen Berhasil Diupload',
          text: 'Dokumen Anda telah berhasil diupload ke sistem.',
          confirmButtonText: 'OK'
        });
        
        // Update document preview in step 4
        updateDocumentPreview(
          document.getElementById('docFieldName').value,
          response.fileUrl,
          document.getElementById('documentFile').files[0].name
        );
      } else {
        showError(response.message || 'Terjadi kesalahan saat mengupload dokumen');
      }
    }
    
    // Handle document upload error
    function handleDocumentUploadError(error) {
      hideLoading();
      showError(error.message || 'Terjadi kesalahan saat mengupload dokumen');
    }
    
    // Update document preview in step 4
    function updateDocumentPreview(fieldName, fileUrl, fileName) {
      const previewContainer = document.getElementById(`${fieldName}_preview`);
      
      if (previewContainer) {
        const fileType = fileName.split('.').pop().toLowerCase();
        let iconClass = 'bi-file-earmark-text';
        
        if (fileType === 'pdf') {
          iconClass = 'bi-file-earmark-pdf';
        } else if (['jpg', 'jpeg', 'png'].includes(fileType)) {
          iconClass = 'bi-file-earmark-image';
        }
        
        previewContainer.innerHTML = `
          <div class="document-item">
            <i class="bi ${iconClass}"></i>
            <span class="flex-grow-1">${fileName}</span>
            <a href="${fileUrl}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-eye"></i>
            </a>
          </div>
        `;
      }
    }
    
    // Print registration proof
    function printRegistration(nomorPendaftaran) {
      // In a real app, you would generate a printable version
      // For now, we'll just use the browser's print function
      window.print();
    }
    
    // Load schedule data
    function loadScheduleData() {
      showLoading('Memuat jadwal...');
      
      google.script.run
        .withSuccessHandler(handleScheduleDataSuccess)
        .withFailureHandler(handleScheduleDataError)
        .getScheduleData();
    }
    
    // Handle successful schedule data load
    function handleScheduleDataSuccess(response) {
      hideLoading();
      
      if (response.success && response.data.length > 0) {
        const container = document.getElementById('scheduleContainer');
        let html = '';
        
        response.data.forEach(item => {
          html += `
            <div class="col-md-6 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">${item.Kegiatan}</h5>
                  <p class="card-text">
                    <i class="bi bi-calendar-event me-2"></i>
                    ${formatDate(item['Tanggal Mulai'])} - ${formatDate(item['Tanggal Selesai'])}
                  </p>
                  <p class="card-text">
                    <i class="bi bi-clock me-2"></i>
                    ${item['Waktu Pengumuman'] || '-'}
                  </p>
                  <p class="card-text">${item.Keterangan}</p>
                </div>
              </div>
            </div>
          `;
        });
        
        container.innerHTML = html;
      }
    }
    
    // Handle schedule data error
    function handleScheduleDataError(error) {
      hideLoading();
      document.getElementById('scheduleContainer').innerHTML = `
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Gagal memuat jadwal: ${error.message || 'Terjadi kesalahan'}
        </div>
      `;
    }
    
    // Load fees data
    function loadFeesData() {
      showLoading('Memuat biaya...');
      
      google.script.run
        .withSuccessHandler(handleFeesDataSuccess)
        .withFailureHandler(handleFeesDataError)
        .getFeeData();
    }
    
    // Handle successful fees data load
    function handleFeesDataSuccess(response) {
      hideLoading();
      
      if (response.success && response.data.length > 0) {
        const container = document.querySelector('#feesTable tbody');
        let html = '';
        
        response.data.forEach(item => {
          html += `
            <tr>
              <td>${item['Jenis Biaya']}</td>
              <td>${formatCurrency(item.Nominal)}</td>
              <td>${item.Keterangan}</td>
              <td>${item['Batas Pembayaran'] ? formatDate(item['Batas Pembayaran']) : '-'}</td>
            </tr>
          `;
        });
        
        container.innerHTML = html;
      }
    }
    
    // Handle fees data error
    function handleFeesDataError(error) {
      hideLoading();
      document.querySelector('#feesTable tbody').innerHTML = `
        <tr>
          <td colspan="4" class="text-center text-danger">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Gagal memuat data biaya: ${error.message || 'Terjadi kesalahan'}
          </td>
        </tr>
      `;
    }
    
    // Check registration status
    function checkRegistrationStatus() {
      const nomor = document.getElementById('statusNomor').value;
      const nisn = document.getElementById('statusNISN').value;
      
      if (!nomor || !nisn) {
        showError('Nomor pendaftaran dan NISN harus diisi');
        return;
      }
      
      showLoading('Memeriksa status...');
      
      google.script.run
        .withSuccessHandler(handleStatusCheckSuccess)
        .withFailureHandler(handleStatusCheckError)
        .handleCheckStatus({ nomor, nisn });
    }
    
    // Handle successful status check
    function handleStatusCheckSuccess(response) {
      hideLoading();
      
      if (response.success) {
        const data = response.data;
        const statusBadge = getStatusBadge(data.Status);
        
        let documentsHtml = '<p class="text-muted">Tidak ada dokumen</p>';
        if (data.Dokumen && data.Dokumen.length > 0) {
          documentsHtml = data.Dokumen.map(doc => `
            <div class="document-item">
              <i class="bi ${getDocumentIcon(doc.url)}"></i>
              <span class="flex-grow-1">${doc.field} - ${doc.name}</span>
              <a href="${doc.url}" target="_blank" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye"></i>
              </a>
            </div>
          `).join('');
        }
        
        const resultHtml = `
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Status Pendaftaran</h5>
              ${statusBadge}
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-md-6">
                  <p><strong>Nomor Pendaftaran:</strong> ${data['Nomor Pendaftaran']}</p>
                  <p><strong>Nama:</strong> ${data.Nama}</p>
                  <p><strong>Asal Sekolah:</strong> ${data['Asal Sekolah']}</p>
                </div>
                <div class="col-md-6">
                  <p><strong>Tanggal Daftar:</strong> ${data['Tanggal Daftar']}</p>
                  <p><strong>Jenis Pendaftaran:</strong> ${data['Jenis Pendaftaran']}</p>
                  <p><strong>Tahun Ajaran:</strong> ${data['Tahun Ajaran']}</p>
                </div>
              </div>
              
              <h6 class="mb-3">Dokumen Pendaftaran</h6>
              <div class="mb-3">
                ${documentsHtml}
              </div>
              
              <div class="d-flex justify-content-between">
                <button class="btn btn-outline-primary" onclick="showStudentLoginModal()">
                  <i class="bi bi-box-arrow-in-right me-2"></i> Login untuk Update Data
                </button>
                <button class="btn btn-primary" onclick="printStatus('${data['Nomor Pendaftaran']}')">
                  <i class="bi bi-printer-fill me-2"></i> Cetak
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.getElementById('statusResult').innerHTML = resultHtml;
      } else {
        showError(response.message || 'Terjadi kesalahan saat memeriksa status');
      }
    }
    
    // Handle status check error
    function handleStatusCheckError(error) {
      hideLoading();
      showError(error.message || 'Terjadi kesalahan saat memeriksa status');
    }
    
    // Print status
    function printStatus(nomorPendaftaran) {
      // In a real app, you would generate a printable version
      // For now, we'll just use the browser's print function
      window.print();
    }
    
    // Show student login modal
    function showStudentLoginModal() {
      const nomor = document.getElementById('statusNomor').value;
      const nisn = document.getElementById('statusNISN').value;
      
      document.getElementById('studentNomor').value = nomor;
      document.getElementById('studentNISN').value = nisn;
      
      const modal = new bootstrap.Modal(document.getElementById('studentLoginModal'));
      modal.show();
    }
    
    // Handle student login
    function handleStudentLogin() {
      const nomor = document.getElementById('studentNomor').value;
      const nisn = document.getElementById('studentNISN').value;
      
      if (!nomor || !nisn) {
        showError('Nomor pendaftaran dan NISN harus diisi');
        return;
      }
      
      showLoading('Memproses login...');
      
      google.script.run
        .withSuccessHandler(handleStudentLoginSuccess)
        .withFailureHandler(handleStudentLoginError)
        .handleStudentLogin({ nomor, nisn });
    }
    
    // Handle successful student login
    function handleStudentLoginSuccess(response) {
      hideLoading();
      
      if (response.success) {
        // Save student data
        studentData = response.data;
        
        // Close login modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('studentLoginModal'));
        modal.hide();
        
        // Show student dashboard
        showStudentDashboard();
      } else {
        showError(response.message || 'Login gagal');
      }
    }
    
    // Handle student login error
    function handleStudentLoginError(error) {
      hideLoading();
      showError(error.message || 'Login gagal');
    }
    
    // Show student dashboard
    function showStudentDashboard() {
      const container = document.getElementById('statusResult');
      const statusBadge = getStatusBadge(studentData.Status);
      
      let documentsHtml = '<p class="text-muted">Tidak ada dokumen</p>';
      if (studentData.Dokumen && studentData.Dokumen.length > 0) {
        documentsHtml = studentData.Dokumen.map(doc => `
          <div class="document-item">
            <i class="bi ${getDocumentIcon(doc.url)}"></i>
            <span class="flex-grow-1">${doc.field} - ${doc.name}</span>
            <a href="${doc.url}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-eye"></i>
            </a>
          </div>
        `).join('');
      }
      
      const dashboardHtml = `
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Dashboard Siswa</h5>
            ${statusBadge}
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-6">
                <p><strong>Nomor Pendaftaran:</strong> ${studentData['Nomor Pendaftaran']}</p>
                <p><strong>Nama:</strong> ${studentData.Nama}</p>
                <p><strong>Asal Sekolah:</strong> ${studentData['Asal Sekolah']}</p>
                <p><strong>Jenis Pendaftaran:</strong> ${studentData['Jenis Pendaftaran']}</p>
              </div>
              <div class="col-md-6">
                <p><strong>Tanggal Daftar:</strong> ${studentData['Tanggal Daftar']}</p>
                <p><strong>Tahun Ajaran:</strong> ${studentData['Tahun Ajaran']}</p>
                <p><strong>Status:</strong> ${studentData.Status}</p>
              </div>
            </div>
            
            <ul class="nav nav-tabs mb-4" id="studentTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab">Dokumen</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab">Profil</button>
              </li>
            </ul>
            
            <div class="tab-content" id="studentTabContent">
              <div class="tab-pane fade show active" id="documents" role="tabpanel">
                <h6 class="mb-3">Dokumen Pendaftaran</h6>
                <div class="mb-3">
                  ${documentsHtml}
                </div>
                
                <button class="btn btn-primary" onclick="showDocumentUploadOptions()">
                  <i class="bi bi-upload me-2"></i> Upload Dokumen
                </button>
              </div>
              
              <div class="tab-pane fade" id="profile" role="tabpanel">
                <form id="studentProfileForm">
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Nama Lengkap</label>
                      <input type="text" class="form-control" value="${studentData.Nama}" readonly>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">NISN</label>
                      <input type="text" class="form-control" value="${studentData.NISN}" readonly>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="studentAlamat" class="form-label">Alamat</label>
                    <textarea class="form-control" id="studentAlamat" rows="3">${studentData.Alamat || ''}</textarea>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="studentWhatsapp" class="form-label">WhatsApp</label>
                      <input type="text" class="form-control" id="studentWhatsapp" value="${studentData.WhatsApp || ''}">
                    </div>
                    <div class="col-md-6">
                      <label for="studentEmail" class="form-label">Email</label>
                      <input type="email" class="form-control" id="studentEmail" value="${studentData.Email || ''}">
                    </div>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="studentPekerjaanAyah" class="form-label">Pekerjaan Ayah</label>
                      <input type="text" class="form-control" id="studentPekerjaanAyah" value="${studentData['Pekerjaan Ayah'] || ''}">
                    </div>
                    <div class="col-md-6">
                      <label for="studentPekerjaanIbu" class="form-label">Pekerjaan Ibu</label>
                      <input type="text" class="form-control" id="studentPekerjaanIbu" value="${studentData['Pekerjaan Ibu'] || ''}">
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="studentWhatsappOrtu" class="form-label">WhatsApp Orang Tua</label>
                    <input type="text" class="form-control" id="studentWhatsappOrtu" value="${studentData['WhatsApp Ortu'] || ''}">
                  </div>
                  
                  <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      `;
      
      container.innerHTML = dashboardHtml;
      
      // Add event listener for profile form
      document.getElementById('studentProfileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        updateStudentProfile();
      });
    }
    
    // Show document upload options
    function showDocumentUploadOptions() {
      const optionsHtml = `
        <div class="card mt-3">
          <div class="card-header">
            <h6 class="mb-0">Upload Dokumen</h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <button class="btn btn-outline-primary w-100" onclick="openDocumentUploadModal('akta_kelahiran', 'Akta Kelahiran')">
                  <i class="bi bi-upload me-2"></i> Akta Kelahiran
                </button>
              </div>
              <div class="col-md-6 mb-3">
                <button class="btn btn-outline-primary w-100" onclick="openDocumentUploadModal('kartu_keluarga', 'Kartu Keluarga')">
                  <i class="bi bi-upload me-2"></i> Kartu Keluarga
                </button>
              </div>
              <div class="col-md-6 mb-3">
                <button class="btn btn-outline-primary w-100" onclick="openDocumentUploadModal('ijazah', 'Ijazah/SKHUN')">
                  <i class="bi bi-upload me-2"></i> Ijazah/SKHUN
                </button>
              </div>
              <div class="col-md-6 mb-3">
                <button class="btn btn-outline-primary w-100" onclick="openDocumentUploadModal('foto', 'Foto 3x4')">
                  <i class="bi bi-upload me-2"></i> Foto 3x4
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      const documentsTab = document.getElementById('documents');
      documentsTab.insertAdjacentHTML('beforeend', optionsHtml);
    }
    
    // Update student profile
    function updateStudentProfile() {
      const updates = {
        alamat: document.getElementById('studentAlamat').value,
        whatsapp: document.getElementById('studentWhatsapp').value,
        email: document.getElementById('studentEmail').value,
        pekerjaan_ayah: document.getElementById('studentPekerjaanAyah').value,
        pekerjaan_ibu: document.getElementById('studentPekerjaanIbu').value,
        whatsapp_ortu: document.getElementById('studentWhatsappOrtu').value
      };
      
      showLoading('Menyimpan perubahan...');
      
      google.script.run
        .withSuccessHandler(handleProfileUpdateSuccess)
        .withFailureHandler(handleProfileUpdateError)
        .handleUpdateStudent({
          nomor: studentData['Nomor Pendaftaran'],
          updates: JSON.stringify(updates)
        });
    }
    
    // Handle successful profile update
    function handleProfileUpdateSuccess(response) {
      hideLoading();
      
      if (response.success) {
        Swal.fire({
          icon: 'success',
          title: 'Profil Berhasil Diupdate',
          text: 'Perubahan pada profil Anda telah disimpan.',
          confirmButtonText: 'OK'
        });
        
        // Update student data
        studentData.Alamat = document.getElementById('studentAlamat').value;
        studentData.WhatsApp = document.getElementById('studentWhatsapp').value;
        studentData.Email = document.getElementById('studentEmail').value;
        studentData['Pekerjaan Ayah'] = document.getElementById('studentPekerjaanAyah').value;
        studentData['Pekerjaan Ibu'] = document.getElementById('studentPekerjaanIbu').value;
        studentData['WhatsApp Ortu'] = document.getElementById('studentWhatsappOrtu').value;
      } else {
        showError(response.message || 'Gagal menyimpan perubahan');
      }
    }
    
    // Handle profile update error
    function handleProfileUpdateError(error) {
      hideLoading();
      showError(error.message || 'Gagal menyimpan perubahan');
    }
    
    // Handle admin login
    function handleAdminLogin() {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      
      if (!username || !password) {
        showError('Username dan password harus diisi');
        return;
      }
      
      showLoading('Memproses login...');
      
      google.script.run
        .withSuccessHandler(handleAdminLoginSuccess)
        .withFailureHandler(handleAdminLoginError)
        .handleAdminLogin({ username, password });
    }
    
    // Handle successful admin login
    function handleAdminLoginSuccess(response) {
      hideLoading();
      
      if (response.success) {
        // Save admin token and user data
        adminToken = response.token;
        currentAdmin = response.user;
        
        // Close login modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('adminLoginModal'));
        modal.hide();
        
        // Show admin dashboard
        showAdminDashboard();
      } else {
        showError(response.message || 'Login gagal');
      }
    }
    
    // Handle admin login error
    function handleAdminLoginError(error) {
      hideLoading();
      showError(error.message || 'Login gagal');
    }
    
    // Show admin dashboard
    function showAdminDashboard() {
      // In a real app, you would replace the entire page content
      // For this example, we'll just show a simple dashboard in a modal
      
      const dashboardHtml = `
        <div class="modal fade" id="adminDashboardModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-xl modal-fullscreen-md-down">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Admin Dashboard - ${currentAdmin.name}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body p-0">
                <div class="d-flex">
                  <!-- Sidebar -->
                  <div class="admin-sidebar" style="width: 250px;">
                    <div class="px-3 py-4">
                      <div class="text-center mb-4">
                        <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                          <i class="bi bi-person-fill" style="font-size: 2.5rem; color: white;"></i>
                        </div>
                        <h6 class="mt-3 mb-1">${currentAdmin.name}</h6>
                        <small class="text-muted">${currentAdmin.role}</small>
                      </div>
                      
                      <ul class="nav flex-column">
                        <li class="nav-item">
                          <a class="nav-link active" href="#" onclick="showAdminTab('dashboard')">
                            <i class="bi bi-speedometer2"></i> Dashboard
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#" onclick="showAdminTab('registrations')">
                            <i class="bi bi-people-fill"></i> Data Pendaftaran
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" href="#" onclick="showAdminTab('documents')">
                            <i class="bi bi-folder-fill"></i> Dokumen Siswa
                          </a>
                        </li>
                        ${currentAdmin.role === 'superadmin' ? `
                        <li class="nav-item">
                          <a class="nav-link" href="#" onclick="showAdminTab('settings')">
                            <i class="bi bi-gear-fill"></i> Pengaturan
                          </a>
                        </li>
                        ` : ''}
                        <li class="nav-item">
                          <a class="nav-link" href="#" onclick="adminLogout()">
                            <i class="bi bi-box-arrow-right"></i> Logout
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  
                  <!-- Main Content -->
                  <div class="flex-grow-1 p-4">
                    <div id="adminTabContent">
                      <!-- Content will be loaded here -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', dashboardHtml);
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('adminDashboardModal'));
      modal.show();
      
      // Load default tab
      showAdminTab('dashboard');
    }
    
    // Show admin tab content
    function showAdminTab(tabName) {
      const tabContent = document.getElementById('adminTabContent');
      
      // Update active nav link
      document.querySelectorAll('.admin-sidebar .nav-link').forEach(link => {
        link.classList.remove('active');
      });
      
      document.querySelector(`.admin-sidebar .nav-link[onclick="showAdminTab('${tabName}')"]`).classList.add('active');
      
      switch(tabName) {
        case 'dashboard':
          loadAdminDashboard();
          break;
        case 'registrations':
          loadRegistrationsList();
          break;
        case 'documents':
          loadDocumentsList();
          break;
        case 'settings':
          loadAdminSettings();
          break;
      }
    }
    
    // Load admin dashboard
    function loadAdminDashboard() {
      const tabContent = document.getElementById('adminTabContent');
      
      tabContent.innerHTML = `
        <h4 class="mb-4">Dashboard Admin</h4>
        
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Statistik Pendaftaran</h5>
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Status Pendaftaran</h5>
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-12">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Aktivitas Terkini</h5>
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Load actual data
      loadAdminDashboardData();
    }
    
    // Load admin dashboard data
    function loadAdminDashboardData() {
      // In a real app, you would fetch data from server
      // For this example, we'll just show some dummy data
      
      setTimeout(() => {
        const tabContent = document.getElementById('adminTabContent');
        
        tabContent.innerHTML = `
          <h4 class="mb-4">Dashboard Admin</h4>
          
          <div class="row">
            <div class="col-md-6 mb-4">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">Statistik Pendaftaran</h5>
                  <div class="row text-center py-3">
                    <div class="col-4">
                      <h3 class="text-primary">124</h3>
                      <p class="text-muted mb-0">Total</p>
                    </div>
                    <div class="col-4">
                      <h3 class="text-success">89</h3>
                      <p class="text-muted mb-0">Diterima</p>
                    </div>
                    <div class="col-4">
                      <h3 class="text-danger">12</h3>
                      <p class="text-muted mb-0">Ditolak</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-4">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">Status Pendaftaran</h5>
                  <div class="text-center py-3">
                    <canvas id="statusChart" height="200"></canvas>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Aktivitas Terkini</h5>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Waktu</th>
                          <th>Aktivitas</th>
                          <th>User</th>
                          <th>Deskripsi</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>14/06/2024 10:30</td>
                          <td>Update Status</td>
                          <td>${currentAdmin.name}</td>
                          <td>Mengubah status pendaftaran SPMB-2024-001 menjadi Diterima</td>
                        </tr>
                        <tr>
                          <td>14/06/2024 09:15</td>
                          <td>Login</td>
                          <td>Admin 2</td>
                          <td>User login ke sistem</td>
                        </tr>
                        <tr>
                          <td>13/06/2024 16:45</td>
                          <td>Pendaftaran Baru</td>
                          <td>Siswa</td>
                          <td>SPMB-2024-124 mendaftar</td>
                        </tr>
                        <tr>
                          <td>13/06/2024 14:20</td>
                          <td>Upload Dokumen</td>
                          <td>Siswa</td>
                          <td>SPMB-2024-123 mengupload ijazah</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Initialize chart
        if (typeof Chart !== 'undefined') {
          const ctx = document.getElementById('statusChart').getContext('2d');
          new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: ['Diterima', 'Ditolak', 'Belum Diverifikasi', 'Dalam Proses'],
              datasets: [{
                data: [89, 12, 18, 5],
                backgroundColor: [
                  '#10b981',
                  '#ef4444',
                  '#64748b',
                  '#f59e0b'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false
            }
          });
        }
      }, 1000);
    }
    
    // Load registrations list
    function loadRegistrationsList() {
      const tabContent = document.getElementById('adminTabContent');
      
      tabContent.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="mb-0">Data Pendaftaran</h4>
          <div>
            <button class="btn btn-outline-primary me-2" onclick="exportRegistrations()">
              <i class="bi bi-download me-2"></i> Export
            </button>
            <button class="btn btn-primary" onclick="refreshRegistrations()">
              <i class="bi bi-arrow-clockwise me-2"></i> Refresh
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover" id="registrationsTable">
                <thead>
                  <tr>
                    <th>No. Pendaftaran</th>
                    <th>Nama</th>
                    <th>Asal Sekolah</th>
                    <th>Status</th>
                    <th>Tanggal Daftar</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="6" class="text-center py-5">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
      
      // Load actual data
      fetchRegistrations();
    }
    
    // Fetch registrations from server
    function fetchRegistrations() {
      showLoading('Memuat data pendaftaran...');
      
      google.script.run
        .withSuccessHandler(handleRegistrationsSuccess)
        .withFailureHandler(handleRegistrationsError)
        .handleGetRegistrations({ token: adminToken });
    }
    
    // Handle successful registrations fetch
    function handleRegistrationsSuccess(response) {
      hideLoading();
      
      if (response.success) {
        const tableBody = document.querySelector('#registrationsTable tbody');
        let html = '';
        
        response.data.forEach(registration => {
          const statusBadge = getStatusBadge(registration.Status);
          
          html += `
            <tr>
              <td>${registration['Nomor Pendaftaran']}</td>
              <td>${registration.Nama}</td>
              <td>${registration['Asal Sekolah']}</td>
              <td>${statusBadge}</td>
              <td>${registration['Tanggal Daftar']}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary" onclick="viewRegistrationDetails('${registration['Nomor Pendaftaran']}')">
                  <i class="bi bi-eye"></i>
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="showStatusUpdateModal('${registration['Nomor Pendaftaran']}', '${registration.Status}')">
                  <i class="bi bi-pencil"></i>
                </button>
              </td>
            </tr>
          `;
        });
        
        tableBody.innerHTML = html;
      } else {
        showError(response.message || 'Gagal memuat data pendaftaran');
      }
    }
    
    // Handle registrations fetch error
    function handleRegistrationsError(error) {
      hideLoading();
      showError(error.message || 'Gagal memuat data pendaftaran');
    }
    
    // View registration details
    function viewRegistrationDetails(nomorPendaftaran) {
      // In a real app, you would fetch detailed data from server
      // For this example, we'll just show a simple modal
      
      const registration = {
        'Nomor Pendaftaran': 'SPMB-2024-001',
        'Nama': 'Contoh Siswa',
        'Asal Sekolah': 'SMP Contoh Takokak',
        'Status': 'Diterima',
        'Tanggal Daftar': '10/06/2024 14:30',
        'NISN': '1234567890',
        'NIK': '1234567890123456',
        'Jenis Kelamin': 'Laki-laki',
        'Tempat Lahir': 'Takokak',
        'Tanggal Lahir': '15/08/2008',
        'Agama': 'Islam',
        'Alamat': 'Jl. Contoh No. 123, Takokak',
        'WhatsApp': '081234567890',
        'Email': 'contoh@email.com',
        'Nama Ayah': 'Contoh Ayah',
        'Pekerjaan Ayah': 'PNS',
        'Nama Ibu': 'Contoh Ibu',
        'Pekerjaan Ibu': 'Ibu Rumah Tangga',
        'WhatsApp Ortu': '081234567891',
        'Jenis Pendaftaran': 'Siswa Baru',
        'Tahun Ajaran': '2024/2025',
        'Tahun Lulus': '2024',
        'Dokumen': [
          { field: 'akta_kelahiran', name: 'Akta_Kelahiran.pdf', url: '#' },
          { field: 'kartu_keluarga', name: 'KK.pdf', url: '#' },
          { field: 'ijazah', name: 'Ijazah_SMP.jpg', url: '#' },
          { field: 'foto', name: 'Foto_3x4.jpg', url: '#' }
        ]
      };
      
      let documentsHtml = '<p class="text-muted">Tidak ada dokumen</p>';
      if (registration.Dokumen && registration.Dokumen.length > 0) {
        documentsHtml = registration.Dokumen.map(doc => `
          <div class="document-item">
            <i class="bi ${getDocumentIcon(doc.url)}"></i>
            <span class="flex-grow-1">${doc.field} - ${doc.name}</span>
            <a href="${doc.url}" target="_blank" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-eye"></i>
            </a>
          </div>
        `).join('');
      }
      
      const modalHtml = `
        <div class="modal fade" id="registrationDetailsModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Detail Pendaftaran - ${nomorPendaftaran}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="card mb-4">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Data Pribadi</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>Nama:</strong> ${registration.Nama}</p>
                        <p><strong>NISN:</strong> ${registration.NISN}</p>
                        <p><strong>NIK:</strong> ${registration.NIK}</p>
                        <p><strong>Jenis Kelamin:</strong> ${registration['Jenis Kelamin']}</p>
                        <p><strong>Tempat, Tanggal Lahir:</strong> ${registration['Tempat Lahir']}, ${registration['Tanggal Lahir']}</p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>Agama:</strong> ${registration.Agama}</p>
                        <p><strong>Alamat:</strong> ${registration.Alamat}</p>
                        <p><strong>WhatsApp:</strong> ${registration.WhatsApp}</p>
                        <p><strong>Email:</strong> ${registration.Email || '-'}</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="card mb-4">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Data Orang Tua</h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>Nama Ayah:</strong> ${registration['Nama Ayah']}</p>
                        <p><strong>Pekerjaan Ayah:</strong> ${registration['Pekerjaan Ayah']}</p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>Nama Ibu:</strong> ${registration['Nama Ibu']}</p>
                        <p><strong>Pekerjaan Ibu:</strong> ${registration['Pekerjaan Ibu']}</p>
                      </div>
                    </div>
                    <p class="mt-2"><strong>WhatsApp Orang Tua:</strong> ${registration['WhatsApp Ortu']}</p>
                  </div>
                </div>
                
                <div class="card mb-4">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Data Sekolah</h6>
                  </div>
                  <div class="card-body">
                    <p><strong>Asal Sekolah:</strong> ${registration['Asal Sekolah']}</p>
                    <p><strong>Tahun Lulus:</strong> ${registration['Tahun Lulus']}</p>
                    <p><strong>Jenis Pendaftaran:</strong> ${registration['Jenis Pendaftaran']}</p>
                    <p><strong>Tahun Ajaran:</strong> ${registration['Tahun Ajaran']}</p>
                  </div>
                </div>
                
                <div class="card">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Dokumen Pendaftaran</h6>
                  </div>
                  <div class="card-body">
                    ${documentsHtml}
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('registrationDetailsModal'));
      modal.show();
    }
    
    // Show status update modal
    function showStatusUpdateModal(nomorPendaftaran, currentStatus) {
      document.getElementById('updateNomorPendaftaran').value = nomorPendaftaran;
      document.getElementById('updateStatus').value = currentStatus;
      document.getElementById('updateNotes').value = '';
      
      const modal = new bootstrap.Modal(document.getElementById('statusUpdateModal'));
      modal.show();
    }
    
    // Update registration status
    function updateRegistrationStatus() {
      const nomor = document.getElementById('updateNomorPendaftaran').value;
      const status = document.getElementById('updateStatus').value;
      const notes = document.getElementById('updateNotes').value;
      
      if (!nomor || !status) {
        showError('Nomor pendaftaran dan status harus diisi');
        return;
      }
      
      showLoading('Memperbarui status...');
      
      google.script.run
        .withSuccessHandler(handleStatusUpdateSuccess)
        .withFailureHandler(handleStatusUpdateError)
        .handleUpdateStatus({
          token: adminToken,
          nomor,
          status,
          notes
        });
    }
    
    // Handle successful status update
    function handleStatusUpdateSuccess(response) {
      hideLoading();
      
      if (response.success) {
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('statusUpdateModal'));
        modal.hide();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Status Berhasil Diupdate',
          text: 'Status pendaftaran telah berhasil diperbarui.',
          confirmButtonText: 'OK'
        });
        
        // Refresh registrations list
        fetchRegistrations();
      } else {
        showError(response.message || 'Gagal memperbarui status');
      }
    }
    
    // Handle status update error
    function handleStatusUpdateError(error) {
      hideLoading();
      showError(error.message || 'Gagal memperbarui status');
    }
    
    // Export registrations to Excel
    function exportRegistrations() {
      showLoading('Menyiapkan file export...');
      
      google.script.run
        .withSuccessHandler(handleExportSuccess)
        .withFailureHandler(handleExportError)
        .exportToExcel({ token: adminToken });
    }
    
    // Handle successful export
    function handleExportSuccess(response) {
      hideLoading();
      
      if (response.success) {
        // Open download link in new tab
        window.open(response.fileUrl, '_blank');
      } else {
        showError(response.message || 'Gagal membuat file export');
      }
    }
    
    // Handle export error
    function handleExportError(error) {
      hideLoading();
      showError(error.message || 'Gagal membuat file export');
    }
    
    // Refresh registrations list
    function refreshRegistrations() {
      fetchRegistrations();
    }
    
    // Load documents list
    function loadDocumentsList() {
      const tabContent = document.getElementById('adminTabContent');
      
      tabContent.innerHTML = `
        <h4 class="mb-4">Dokumen Siswa</h4>
        
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover" id="documentsTable">
                <thead>
                  <tr>
                    <th>No. Pendaftaran</th>
                    <th>Nama</th>
                    <th>Jenis Dokumen</th>
                    <th>Nama File</th>
                    <th>Tanggal Upload</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="6" class="text-center py-5">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
      
      // In a real app, you would fetch documents data from server
      // For this example, we'll just show some dummy data after a delay
      
      setTimeout(() => {
        const tableBody = document.querySelector('#documentsTable tbody');
        
        const dummyData = [
          {
            nomor: 'SPMB-2024-001',
            nama: 'Contoh Siswa 1',
            jenis: 'Akta Kelahiran',
            file: 'Akta_Kelahiran.pdf',
            tanggal: '10/06/2024 14:30',
            url: '#'
          },
          {
            nomor: 'SPMB-2024-001',
            nama: 'Contoh Siswa 1',
            jenis: 'Kartu Keluarga',
            file: 'KK.pdf',
            tanggal: '10/06/2024 14:32',
            url: '#'
          },
          {
            nomor: 'SPMB-2024-002',
            nama: 'Contoh Siswa 2',
            jenis: 'Ijazah',
            file: 'Ijazah_SMP.jpg',
            tanggal: '11/06/2024 09:15',
            url: '#'
          },
          {
            nomor: 'SPMB-2024-003',
            nama: 'Contoh Siswa 3',
            jenis: 'Foto 3x4',
            file: 'Foto.jpg',
            tanggal: '12/06/2024 16:45',
            url: '#'
          }
        ];
        
        let html = '';
        
        dummyData.forEach(doc => {
          html += `
            <tr>
              <td>${doc.nomor}</td>
              <td>${doc.nama}</td>
              <td>${doc.jenis}</td>
              <td>${doc.file}</td>
              <td>${doc.tanggal}</td>
              <td>
                <a href="${doc.url}" target="_blank" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-eye"></i>
                </a>
              </td>
            </tr>
          `;
        });
        
        tableBody.innerHTML = html;
      }, 1000);
    }
    
    // Load admin settings
    function loadAdminSettings() {
      const tabContent = document.getElementById('adminTabContent');
      
      tabContent.innerHTML = `
        <h4 class="mb-4">Pengaturan Sistem</h4>
        
        <div class="card">
          <div class="card-body">
            <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">Umum</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button" role="tab">Jadwal</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="fees-tab" data-bs-toggle="tab" data-bs-target="#fees" type="button" role="tab">Biaya</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">Pengguna</button>
              </li>
            </ul>
            
            <div class="tab-content" id="settingsTabContent">
              <div class="tab-pane fade show active" id="general" role="tabpanel">
                <form id="generalSettingsForm">
                  <div class="mb-3">
                    <label for="schoolName" class="form-label">Nama Sekolah</label>
                    <input type="text" class="form-control" id="schoolName" value="SMAS PGRI Takokak">
                  </div>
                  
                  <div class="mb-3">
                    <label for="schoolAddress" class="form-label">Alamat Sekolah</label>
                    <textarea class="form-control" id="schoolAddress" rows="3">Jl. Pendidikan No. 123, Takokak</textarea>
                  </div>
                  
                  <div class="mb-3">
                    <label for="schoolPhone" class="form-label">Telepon</label>
                    <input type="text" class="form-control" id="schoolPhone" value="(021) 1234567">
                  </div>
                  
                  <div class="mb-3">
                    <label for="schoolEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="schoolEmail" value="info@smatakokak.sch.id">
                  </div>
                  
                  <div class="mb-3">
                    <label for="academicYear" class="form-label">Tahun Ajaran</label>
                    <input type="text" class="form-control" id="academicYear" value="2024/2025">
                  </div>
                  
                  <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                </form>
              </div>
              
              <div class="tab-pane fade" id="schedule" role="tabpanel">
                <div class="d-flex justify-content-end mb-3">
                  <button class="btn btn-primary" onclick="showAddScheduleModal()">
                    <i class="bi bi-plus-circle me-2"></i> Tambah Jadwal
                  </button>
                </div>
                
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Kegiatan</th>
                        <th>Tanggal Mulai</th>
                        <th>Tanggal Selesai</th>
                        <th>Waktu Pengumuman</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Pendaftaran Gelombang 1</td>
                        <td>01/06/2024</td>
                        <td>15/06/2024</td>
                        <td>16/06/2024 10:00</td>
                        <td>
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td>Pendaftaran Gelombang 2</td>
                        <td>16/06/2024</td>
                        <td>30/06/2024</td>
                        <td>01/07/2024 10:00</td>
                        <td>
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              
              <div class="tab-pane fade" id="fees" role="tabpanel">
                <div class="d-flex justify-content-end mb-3">
                  <button class="btn btn-primary" onclick="showAddFeeModal()">
                    <i class="bi bi-plus-circle me-2"></i> Tambah Biaya
                  </button>
                </div>
                
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Jenis Biaya</th>
                        <th>Nominal</th>
                        <th>Keterangan</th>
                        <th>Batas Pembayaran</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Biaya Pendaftaran</td>
                        <td>Rp 250.000</td>
                        <td>Dibayar saat pendaftaran</td>
                        <td>-</td>
                        <td>
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td>Biaya Seragam</td>
                        <td>Rp 500.000</td>
                        <td>Dibayar setelah diterima</td>
                        <td>31/07/2024</td>
                        <td>
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              
              <div class="tab-pane fade" id="users" role="tabpanel">
                <div class="d-flex justify-content-end mb-3">
                  <button class="btn btn-primary" onclick="showAddUserModal()">
                    <i class="bi bi-plus-circle me-2"></i> Tambah Pengguna
                  </button>
                </div>
                
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Nama</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Terakhir Login</th>
                        <th>Aksi</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Admin Utama</td>
                        <td>admin</td>
                        <td>Superadmin</td>
                        <td>14/06/2024 10:30</td>
                        <td>
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger" disabled>
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td>Admin Pendaftaran</td>
                        <td>admin2</td>
                        <td>Admin</td>
                        <td>14/06/2024 09:15</td>
                        <td>
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Add event listeners for settings forms
      document.getElementById('generalSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveGeneralSettings();
      });
    }
    
    // Show add schedule modal
    function showAddScheduleModal() {
      const modalHtml = `
        <div class="modal fade" id="addScheduleModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Tambah Jadwal SPMB</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="addScheduleForm">
                  <div class="mb-3">
                    <label for="scheduleName" class="form-label">Nama Kegiatan</label>
                    <input type="text" class="form-control" id="scheduleName" required>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label for="scheduleStart" class="form-label">Tanggal Mulai</label>
                      <input type="date" class="form-control" id="scheduleStart" required>
                    </div>
                    <div class="col-md-6">
                      <label for="scheduleEnd" class="form-label">Tanggal Selesai</label>
                      <input type="date" class="form-control" id="scheduleEnd" required>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="scheduleAnnouncement" class="form-label">Waktu Pengumuman</label>
                    <input type="datetime-local" class="form-control" id="scheduleAnnouncement">
                  </div>
                  
                  <div class="mb-3">
                    <label for="scheduleNotes" class="form-label">Keterangan</label>
                    <textarea class="form-control" id="scheduleNotes" rows="3"></textarea>
                  </div>
                  
                  <button type="submit" class="btn btn-primary w-100">Simpan Jadwal</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('addScheduleModal'));
      modal.show();
      
      // Add form submit handler
      document.getElementById('addScheduleForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addNewSchedule();
      });
    }
    
    // Add new schedule
    function addNewSchedule() {
      const name = document.getElementById('scheduleName').value;
      const start = document.getElementById('scheduleStart').value;
      const end = document.getElementById('scheduleEnd').value;
      const announcement = document.getElementById('scheduleAnnouncement').value;
      const notes = document.getElementById('scheduleNotes').value;
      
      if (!name || !start || !end) {
        showError('Nama kegiatan, tanggal mulai dan selesai harus diisi');
        return;
      }
      
      showLoading('Menyimpan jadwal...');
      
      // In a real app, you would send this to server
      setTimeout(() => {
        hideLoading();
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('addScheduleModal'));
        modal.hide();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Jadwal Berhasil Ditambahkan',
          text: 'Jadwal baru telah berhasil ditambahkan ke sistem.',
          confirmButtonText: 'OK'
        });
        
        // Refresh schedule list
        // In a real app, you would refresh the data from server
      }, 1000);
    }
    
    // Show add fee modal
    function showAddFeeModal() {
      const modalHtml = `
        <div class="modal fade" id="addFeeModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Tambah Biaya SPMB</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="addFeeForm">
                  <div class="mb-3">
                    <label for="feeType" class="form-label">Jenis Biaya</label>
                    <input type="text" class="form-control" id="feeType" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="feeAmount" class="form-label">Nominal</label>
                    <input type="number" class="form-control" id="feeAmount" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="feeNotes" class="form-label">Keterangan</label>
                    <textarea class="form-control" id="feeNotes" rows="3"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <label for="feeDeadline" class="form-label">Batas Pembayaran</label>
                    <input type="date" class="form-control" id="feeDeadline">
                  </div>
                  
                  <button type="submit" class="btn btn-primary w-100">Simpan Biaya</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('addFeeModal'));
      modal.show();
      
      // Add form submit handler
      document.getElementById('addFeeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addNewFee();
      });
    }
    
    // Add new fee
    function addNewFee() {
      const type = document.getElementById('feeType').value;
      const amount = document.getElementById('feeAmount').value;
      const notes = document.getElementById('feeNotes').value;
      const deadline = document.getElementById('feeDeadline').value;
      
      if (!type || !amount) {
        showError('Jenis biaya dan nominal harus diisi');
        return;
      }
      
      showLoading('Menyimpan biaya...');
      
      // In a real app, you would send this to server
      setTimeout(() => {
        hideLoading();
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('addFeeModal'));
        modal.hide();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Biaya Berhasil Ditambahkan',
          text: 'Biaya baru telah berhasil ditambahkan ke sistem.',
          confirmButtonText: 'OK'
        });
        
        // Refresh fee list
        // In a real app, you would refresh the data from server
      }, 1000);
    }
    
    // Show add user modal
    function showAddUserModal() {
      const modalHtml = `
        <div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Tambah Pengguna Admin</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="addUserForm">
                  <div class="mb-3">
                    <label for="userName" class="form-label">Nama Lengkap</label>
                    <input type="text" class="form-control" id="userName" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="userUsername" class="form-label">Username</label>
                    <input type="text" class="form-control" id="userUsername" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="userPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="userPassword" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="userRole" class="form-label">Role</label>
                    <select class="form-select" id="userRole" required>
                      <option value="admin">Admin</option>
                      <option value="superadmin">Superadmin</option>
                    </select>
                  </div>
                  
                  <button type="submit" class="btn btn-primary w-100">Simpan Pengguna</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('addUserModal'));
      modal.show();
      
      // Add form submit handler
      document.getElementById('addUserForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addNewUser();
      });
    }
    
    // Add new user
    function addNewUser() {
      const name = document.getElementById('userName').value;
      const username = document.getElementById('userUsername').value;
      const password = document.getElementById('userPassword').value;
      const role = document.getElementById('userRole').value;
      
      if (!name || !username || !password || !role) {
        showError('Semua field harus diisi');
        return;
      }
      
      showLoading('Menyimpan pengguna...');
      
      // In a real app, you would send this to server
      setTimeout(() => {
        hideLoading();
        
        // Close modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
        modal.hide();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Pengguna Berhasil Ditambahkan',
          text: 'Pengguna admin baru telah berhasil ditambahkan ke sistem.',
          confirmButtonText: 'OK'
        });
        
        // Refresh user list
        // In a real app, you would refresh the data from server
      }, 1000);
    }
    
    // Save general settings
    function saveGeneralSettings() {
      const name = document.getElementById('schoolName').value;
      const address = document.getElementById('schoolAddress').value;
      const phone = document.getElementById('schoolPhone').value;
      const email = document.getElementById('schoolEmail').value;
      const year = document.getElementById('academicYear').value;
      
      if (!name || !address || !phone || !year) {
        showError('Nama sekolah, alamat, telepon dan tahun ajaran harus diisi');
        return;
      }
      
      showLoading('Menyimpan pengaturan...');
      
      // In a real app, you would send this to server
      setTimeout(() => {
        hideLoading();
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Pengaturan Berhasil Disimpan',
          text: 'Pengaturan umum telah berhasil diperbarui.',
          confirmButtonText: 'OK'
        });
      }, 1000);
    }
    
    // Admin logout
    function adminLogout() {
      adminToken = null;
      currentAdmin = null;
      
      // Close admin dashboard modal
      const modal = bootstrap.Modal.getInstance(document.getElementById('adminDashboardModal'));
      modal.hide();
      
      // Show logout message
      Swal.fire({
        icon: 'success',
        title: 'Logout Berhasil',
        text: 'Anda telah berhasil logout dari sistem admin.',
        confirmButtonText: 'OK'
      });
    }
    
    // Utility functions
    function formatDate(dateString) {
      if (!dateString) return '-';
      
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return dateString;
      
      return date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }
    
    function formatCurrency(amount) {
      if (!amount) return 'Rp 0';
      return 'Rp ' + parseInt(amount).toLocaleString('id-ID');
    }
    
    function formatFileSize(bytes) {
      if (!bytes) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function getStatusBadge(status) {
      let badgeClass = 'status-pending';
      if (status === 'Diterima') badgeClass = 'status-verified';
      if (status === 'Ditolak') badgeClass = 'status-rejected';
      
      return `<span class="status-badge ${badgeClass}">${status}</span>`;
    }
    
    function getDocumentIcon(url) {
      if (!url) return 'bi-file-earmark-text';
      
      const ext = url.split('.').pop().toLowerCase();
      if (ext === 'pdf') return 'bi-file-earmark-pdf';
      if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'bi-file-earmark-image';
      
      return 'bi-file-earmark-text';
    }
    
    function showLoading(text = 'Memproses...') {
      document.getElementById('loadingText').textContent = text;
      document.getElementById('loadingSpinner').style.display = 'flex';
    }
    
    function hideLoading() {
      document.getElementById('loadingSpinner').style.display = 'none';
    }
    
    function showError(message) {
      Swal.fire({
        icon: 'error',
        title: 'Terjadi Kesalahan',
        text: message,
        confirmButtonText: 'OK'
      });
    }
    
    function showSuccess(message) {
      Swal.fire({
        icon: 'success',
        title: 'Berhasil',
        text: message,
        confirmButtonText: 'OK'
      });
    }
  </script>
</body>
</html>
